function keyboardfocusCall(){$.keyFocus={};$.keyFocus.conf={keyFocusClass:"keyboard-focus",mouseFocusClass:"mouse-focus",focusClass:"focus",mouseTimeout:50};$.fn.trackFocus=function(){$(this).data("last-device-used","");$(this).bind("mousedown",function(){$(this).data("last-device-used","mouse");$(this).data("last-device-used-when",(new Date).getTime())}).bind("keydown",function(){$(this).data("last-device-used","keyboard")}).bind("focusin",function(n){$(this).data("last-device-used")!="mouse"||(new Date).getTime()-50>$(this).data("last-device-used-when")?$(n.target).addClass($.keyFocus.conf.keyFocusClass):$(n.target).addClass($.keyFocus.conf.mouseFocusClass);$(n.target).addClass($.keyFocus.conf.focusClass)}).bind("focusout",function(n){$("."+$.keyFocus.conf.keyFocusClass+", ."+$.keyFocus.conf.mouseFocusClass).removeClass($.keyFocus.conf.keyFocusClass+" "+$.keyFocus.conf.mouseFocusClass);$(n.target).removeClass($.keyFocus.conf.focusClass)})};$("#header").trackFocus()}function highlightpanelCall(n){var t=n,e=t.find(".hl-pnl-inner .pnl-row"),f=t.find(".pnl").eq(2).outerHeight(),o=$("#main"),r,i,s,h,c,u;t.addClass("js-open").prepend('<div class="hl-pnl-nav"><ul><li class="hl-prev"><span class="icon icon-med arw-up">Previous<\/span><span class="trans-icon-bg"><\/span><\/li><li class="hl-next"><span class="icon icon-med arw-dwn">Next<\/span><span class="trans-icon-bg"><\/span><\/li><\/ul><\/div>');r=o.find(".hl-prev");i=o.find(".hl-next");r.hide();s=t.find(".pnl-lnk").height()+i.height()*2;h=i.outerHeight()+"px";t.css("height",s+"px");c=t.find(".pnl").length/3;u=0;e.css("padding-top",h);f=f+16;i.click(function(){e.animate({marginTop:"-="+f+"px"},300);r.fadeIn("slow");u++;u==c-1&&i.hide()});r.click(function(){e.animate({marginTop:"+="+f+"px"},300);u--;u===0&&r.hide();i.fadeIn("slow")})}function hoverIntentCall(){var n=$("#primary-nav").find(".primary-nav-item"),t,i;n.keydown(function(){$(this).find("a").hasClass("focus")&&(n.removeClass("parent"),$(this).addClass("parent"))});n.mouseleave(function(){n.removeClass("parent")});t=n.children("ul");t.addClass("hover-intent");navigator.userAgent.match(/iPad/i)!==null?$(document).click(function(n){t.addClass("hover-intent");var i=$(n.target);i.is("h3",".primary-nav-item")?i.parent().next("ul").removeClass("hover-intent"):t.addClass("hover-intent")}):(n.find("a").mouseenter(function(){clearTimeout(i);var n=$(this);i=setTimeout(function(){n.next("ul").removeClass("hover-intent")},500)}),n.mouseleave(function(){t.addClass("hover-intent");clearTimeout(i)}))}function onSelectDate(n){for(var t={},s=window.location.search,u=s.replace("?","").split("&"),r,i=0,f=u.length;i<f;i++){var e=u[i].split("="),o=e[0],h=e[1];o&&(t[o.toString()]=h)}r="/events";t.day_eventlistingentry=n;t.page="1";r="/events?"+$.param(t);document.location=r;return}function initDateCall1(){$("#datepickerfacet").datepicker({minDate:0,maxDate:"+4M +0D",dateFormat:"yymmdd",onSelect:function(n){onSelectDate(n)}})}function initDateCall2(){$("#datepicker").datepicker({minDate:0,maxDate:"+4M +0D",dateFormat:"yymmdd",onSelect:function(n){onSelectDate(n)}})}function expandareaCall(){var i=$("#main"),t=i.find(".exp-content"),r=i.find(".exp-handle"),n=r.find("a");t.hide();n.click(function(i){i.preventDefault();n.hasClass("open")?(t.hide(),n.removeClass("open")):(t.show(),n.addClass("open"))})}function equalHeightRowsWithTwitter(){var n=$("#twitterWithRows").find("ul").height();$("#twitterwrapper").css("height",n)}function equalHeightCall(n){if(!$(document.body).hasClass("catalogue-homepage")){var r=$("#main").find(".main-content-block-inner").children(".pnl-block").children(".lrg-img-pnl.grid_30"),t=0,i=0;function u(n){function t(n){return("0"+parseInt(n).toString(16)).slice(-2)}return n.search("rgb")==-1?n:(n=n.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+t(n[1])+t(n[2])+t(n[3]))}n.each(function(){var n,o,s,l,f;if(!$(this).hasClass("msnry")&&!$(this).hasClass("no-eq-height"))if(n=0,o=$(this).find(".pnl"),o.each(function(){var t=$(this).height();t>n&&(n=t)}),o.find(".pnl-lnk").length!==0)$(this).find(".pnl-inner").css("height",n);else if($(this).is(r)){if(t=t+1,t===1&&$(this).find(".pnl").length>1&&$(this).find(".pnl").each(function(){s=$(this).height();s>i&&(i=s)}),t===2){var e=$(this).parent(".pnl-block").children(".lrg-img-pnl.grid_30").first(),c=e.find(".pnl-inner").height(),h=e.siblings().find(".pnl-inner").height();if(n=i>h?i:c>h?c:h,document.getElementById("twitterwrapper")&&(n<250&&(n=250),l=u($("#main").find("a").first().css("color")),$("#twitterwrapper").find(".twitter-timeline").attr({height:n,"data-link-color":l})),f=e.find(".pnl-inner").add(e.next().find(".pnl-inner")),f.find(".video-block").length!==0){f.css("height",n+20);$(this).one("click",function(){f.height(n+50)})}else f.css("height",n);t=0;i=0}}else $(this).hasClass("single-hl-pnl")||$(this).find(".pnl-inner").css("height",n)})}}function mediaTimes(n){var t=n.find(".video-info").add(n.find(".audio-info"));t.each(function(){var i=$(this).closest(n),u=i.find("*[data-time]"),r;u.length!==0&&($(this).append('<span class="time">'+u.attr("data-time")+"<\/span>"),r=i.find(t),i.find("a").add(i.find("span","a")).mouseover(function(){r.addClass("showTime")}).mouseout(function(){r.removeClass("showTime")}))})}function printCall(){$("#sociallinkstop").find(".print-page").click(function(){window.print()})}(function(n){n(document).ready(function(){var t=n("#main"),i,r;n(document.body).hasClass("voicesofscience")&&(i=t.find(".hl-pnl"),i.length!==0&&highlightpanelCall(i));hoverIntentCall();keyboardfocusCall();t.find(".exp-area").length!==0&&expandareaCall();n("#datepickerfacet").length!==0&&initDateCall1();n("#datepicker").length!==0&&initDateCall2();r=t.find(".pnl-media");r.length!==0&&mediaTimes(r);n("#twitterWithRows").length!==0&&equalHeightRowsWithTwitter();printCall()});n(window).load(function(){var t=n("#main").find(".pnl-row");t.length!==0&&equalHeightCall(t)})})(jQuery)